<div class="container app-lender-maintenance">
  <div class="row">
    <div class="col col-12">
      <div class="panel">
        <div class="row panel-header">
          <div class="col col-12">
            <h2>Lender Maintainance</h2>
          </div>
        </div>
        <div class="row panel-body">
          <app-loading-spinner *ngIf="lenderStartLoaded"></app-loading-spinner>
          <div *ngIf="!lenderStartLoaded && !lenderLoadedSucceed" class="col">
            <button class="btn btn-primary" (click)="fetchLenders()">
              Retry
            </button>
          </div>
          <div
            *ngIf="!lenderStartLoaded && lenderLoadedSucceed"
            class="table-responsive"
          >
            <table
              class="table table-hover table-fixed table-striped lenders-table"
            >
              <thead>
                <tr>
                  <th class="col-1 lenders-table-text-bold">Bank Code</th>
                  <th class="col-3 lenders-table-text-bold">Display Name</th>
                  <th class="col-1 lenders-table-text-bold">Type</th>
                  <th class="col-3 text-center lenders-table-text-bold">
                    <div class="row">
                      <div class="col-12">Commission</div>
                    </div>
                    <div class="row">
                      <div class="col-4 text-center">Upfront</div>
                      <div class="col-4 text-center">Trail High</div>
                      <div class="col-4 text-center">Trail Low</div>
                    </div>
                  </th>
                  <th class="col-1 text-center lenders-table-text-bold">
                    Balance Multipler
                  </th>
                  <th class="col-1 text-center lenders-table-text-bold">
                    Active
                  </th>
                  <th class="col-1 text-center lenders-table-text-bold">
                    Hide
                  </th>
                  <th class="col-1 lenders-table-text-bold">Edit</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let lender of lendersWithEdited">
                  <td class="col-1 lenders-table-text-bold">
                    <span *ngIf="!lender.isEditMode">
                      {{ lender.attributes.code }}
                    </span>
                    <select
                      name="bankCode"
                      id="bankCode"
                      *ngIf="lender.isEditMode"
                      (change)="onBankChanged($event, lender, 'code')"
                    >
                      <option
                        *ngFor="let bank of banks; index as index"
                        [value]="bank.code"
                        [selected]="bank.code === lender.attributes.code"
                      >
                        {{ bank.code }}
                      </option>
                    </select>
                  </td>
                  <td class="col-3">
                    <span *ngIf="!lender.isEditMode">
                      {{ lender.attributes.name }}
                    </span>
                    <select
                      name="displayName"
                      id="displayName"
                      *ngIf="lender.isEditMode"
                      (change)="onBankChanged($event, lender, 'name')"
                    >
                      <option
                        *ngFor="let bank of banks"
                        [value]="bank.name"
                        [selected]="bank.name === lender.attributes.name"
                      >
                        {{ bank.name }}
                      </option>
                    </select>
                  </td>
                  <td class="col-1">
                    <span *ngIf="!lender.isEditMode">
                      {{ lender.attributes.type | titlecase }}
                    </span>
                    <select name="type" id="type" *ngIf="lender.isEditMode">
                      <option
                        *ngFor="let type of types"
                        [value]="type"
                        [selected]="type === lender.attributes.type"
                      >
                        {{ type | titlecase }}
                      </option>
                    </select>
                  </td>
                  <td class="col-3 text-center">
                    <div class="row">
                      <div class="col-4 text-center">
                        <span *ngIf="!lender.isEditMode">
                          %{{
                            lender.attributes.upfont_commission / 100
                              | number : "1.0-2"
                          }}
                        </span>
                        <input
                          *ngIf="lender.isEditMode"
                          class="input-number"
                          type="number"
                          min="0"
                          max="100"
                          [value]="lender.attributes.upfont_commission"
                          (change)="
                            onNumberChanged($event, lender, 'upfont_commission')
                          "
                        />
                      </div>
                      <div class="col-4 text-center">
                        <span *ngIf="!lender.isEditMode">
                          %{{
                            lender.attributes.high_trail_commission / 100
                              | number : "1.0-2"
                          }}
                        </span>
                        <input
                          *ngIf="lender.isEditMode"
                          class="input-number"
                          type="number"
                          min="0"
                          max="100"
                          [value]="lender.attributes.high_trail_commission"
                          (change)="
                            onNumberChanged(
                              $event,
                              lender,
                              'high_trail_commission'
                            )
                          "
                        />
                      </div>
                      <div class="col-4 text-center">
                        <span *ngIf="!lender.isEditMode">
                          %{{
                            lender.attributes.low_trail_commission / 100
                              | number : "1.0-2"
                          }}
                        </span>
                        <input
                          *ngIf="lender.isEditMode"
                          class="input-number"
                          type="number"
                          min="0"
                          max="100"
                          [value]="lender.attributes.low_trail_commission"
                          (change)="
                            onNumberChanged(
                              $event,
                              lender,
                              'low_trail_commission'
                            )
                          "
                        />
                      </div>
                    </div>
                  </td>
                  <td class="col-1 text-center">
                    <span *ngIf="!lender.isEditMode">
                      {{ lender.attributes.balance_multiplier }}
                    </span>
                    <input
                      *ngIf="lender.isEditMode"
                      class="input-number"
                      type="number"
                      min="0"
                      max="100"
                      [value]="lender.attributes.balance_multiplier"
                      (change)="
                        onNumberChanged($event, lender, 'balance_multiplier')
                      "
                    />
                  </td>
                  <td class="col-1 text-center">
                    <input
                      type="checkbox"
                      [disabled]="!lender.isEditMode"
                      [checked]="lender.attributes.is_active"
                      (change)="onCheckboxChanged($event, lender, 'is_active')"
                    />
                  </td>
                  <td class="col-1 text-center">
                    <input
                      type="checkbox"
                      [disabled]="!lender.isEditMode"
                      [checked]="lender.attributes.is_hidden"
                      (change)="onCheckboxChanged($event, lender, 'is_hidden')"
                    />
                  </td>
                  <td class="col-1">
                    <div (click)="toggleIsEdit(lender)" class="edit-button">
                      <i class="fa fa-pencil" aria-hidden="true"></i> Edit
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
